<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMS - Internal Knowledge Search</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">üìö AMS</div>
            <div class="nav-search">
                <div class="nav-search-icon">üîç</div>
                <input type="text" placeholder="Search documents..." id="navSearchInput">
            </div>
            <div class="nav-items">
                <a href="#" class="nav-link active" onclick="showSection('search')">Search</a>
                <a href="#" class="nav-link" onclick="showSection('upload')">Upload</a>
                <a href="#" class="nav-link">Analytics</a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <main class="content-area">
            <div class="content-header">
                <h1 class="content-title" id="contentTitle">Document Search</h1>
                <p class="content-subtitle" id="contentSubtitle">Find information across your company's document library</p>
            </div>

            <section class="upload-section" id="uploadSection">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-text">Drop PDF files here or click to browse</div>
                    <div class="upload-subtext">Support for PDF documents up to 50MB each</div>
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Choose Files</button>
                    <input type="file" id="fileInput" multiple accept=".pdf" style="display: none;">
                </div>
                
                <div class="file-list" id="fileList" style="display: none;">
                    <!-- Uploaded files will appear here -->
                </div>
            </section>

            <section class="search-section" id="searchSection">
                <div class="search-container">
                    <input type="text" class="main-search-input" placeholder="What would you like to know?" id="searchInput">
                    <button class="main-search-btn" onclick="performSearch()">Search</button>
                    <div id="searchIndicator" style="display: none;">
                        Searching...
                    </div>
                </div>

                <div class="filters">
                    <button class="filter-btn active" data-filter="all">All Documents</button>
                    <button class="filter-btn" data-filter="policy">Policies</button>
                    <button class="filter-btn" data-filter="manual">Manuals</button>
                    <button class="filter-btn" data-filter="faq">FAQs</button>
                    <button class="filter-btn" data-filter="guide">Guides</button>
                </div>
            </section>

            <section class="results-section" id="resultsSection">
                <div class="loading" id="defaultState">
                    <h3>üîç Ready to search</h3>
                    <p>Upload PDF documents first, then search through them for relevant information.</p>
                </div>
                <div id="debugControls" style="display: none; margin-top: 20px; text-align: center;">
                    <button onclick="restoreSearchResults()" style="padding: 8px 16px; background: #0a66c2; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Restore Search Results
                    </button>
                    <button onclick="testSearch()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                        Test Search
                    </button>
                    <button onclick="ensureUploadSectionVisible()" style="padding: 8px 16px; background: #ffc107; color: black; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                        Show Upload Section
                    </button>
                    <button onclick="forceUploadMode()" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                        Force Upload Mode
                    </button>
                    <button onclick="console.log('Search Results:', searchResults); console.log('Last Query:', lastSearchQuery);" style="padding: 8px 16px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                        Debug Info
                    </button>
                </div>
            </section>
        </main>

        <aside class="sidebar">
            <div class="sidebar-card">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">Library Stats</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Total Documents</span>
                        <span class="stat-number" id="totalDocsStat">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Pages Indexed</span>
                        <span class="stat-number" id="pagesIndexedStat">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Last Updated</span>
                        <span class="stat-number" id="lastUpdatedStat">Never</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Search Accuracy</span>
                        <span class="stat-number" id="accuracyStat">--</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-card">
                <div class="sidebar-header">
                    <h2 class="sidebar-title">Recent Searches</h2>
                </div>
                <div class="recent-searches" id="recentSearchesList">
                    <div class="recent-item">No recent searches</div>
                </div>
            </div>
        </aside>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage"></p>
        </div>
    </div>

    <script>
        // Navigation functionality
        function showSection(section) {
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show/hide sections
            if (section === 'upload') {
                document.getElementById('uploadSection').classList.add('active');
                document.getElementById('searchSection').style.display = 'none';
                document.getElementById('contentTitle').textContent = 'Document Upload';
                document.getElementById('contentSubtitle').textContent = 'Upload PDF documents to make them searchable';
                document.getElementById('fileList').style.display = 'block';
            } else {
                document.getElementById('uploadSection').classList.remove('active');
                document.getElementById('searchSection').style.display = 'block';
                document.getElementById('contentTitle').textContent = 'Document Search';
                document.getElementById('contentSubtitle').textContent = 'Find information across your company\'s document library';
            }
        }

        // File upload functionality
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type === 'application/pdf') {
                    // In a real implementation, you would upload the file to your server
                    console.log('Uploading file:', file.name);
                    // Show upload progress, then add to file list
                    addFileToList(file);
                } else {
                    alert('Only PDF files are supported');
                }
            });
        }

        function addFileToList(file) {
            const fileList = document.getElementById('fileList');
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-icon">üìÑ</div>
                <div class="file-info">
                    <div class="file-name">${file.name}</div>
                    <div class="file-meta">${(file.size / 1024 / 1024).toFixed(1)} MB ‚Ä¢ Just uploaded</div>
                </div>
                <div class="file-status status-processing">Processing</div>
            `;
            fileList.appendChild(fileItem);
            
            // Simulate processing completion
            setTimeout(() => {
                const status = fileItem.querySelector('.file-status');
                status.textContent = 'Indexed';
                status.className = 'file-status status-complete';
            }, 3000);
        }
        let searchResults = [];

        // Sample data for demonstration
        const sampleResults = [
            {
                title: "Employee Handbook - Remote Work Policy",
                snippet: "Remote work is permitted for all eligible employees with manager approval. Employees must maintain regular communication and meet all productivity standards while working from home.",
                document: "Employee_Handbook_2024.pdf",
                page: 23,
                confidence: 95,
                type: "policy",
                lastUpdated: "2024-01-15"
            },
            {
                title: "IT Security Guidelines - Password Requirements",
                snippet: "All passwords must be at least 12 characters long and include a combination of uppercase, lowercase, numbers, and special characters. Passwords should be changed every 90 days.",
                document: "IT_Security_Manual.pdf",
                page: 8,
                confidence: 92,
                type: "manual",
                lastUpdated: "2024-02-01"
            },
            {
                title: "Vacation Policy FAQ",
                snippet: "Vacation requests should be submitted at least 2 weeks in advance through the HR portal. Approval is subject to business needs and team coverage.",
                document: "HR_FAQ_2024.pdf",
                page: 15,
                confidence: 88,
                type: "faq",
                lastUpdated: "2024-01-10"
            }
        ];

        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.filter;
                if (searchResults.length > 0) {
                    displayResults(searchResults);
                }
            });
        });

        // Search input enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Nav search functionality
        document.getElementById('navSearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('searchInput').value = this.value;
                performSearch();
            }
        });

        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            showLoading();
            
            // Simulate API call delay
            setTimeout(() => {
                searchResults = sampleResults.map(result => ({
                    ...result,
                    snippet: highlightSearchTerms(result.snippet, query)
                }));
                displayResults(searchResults);
            }, 1200);
        }

        function showLoading() {
            document.getElementById('resultsSection').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <h3>Searching documents...</h3>
                    <p>Analyzing your query and finding relevant information</p>
                </div>
            `;
        }

        function displayResults(results) {
            const filteredResults = currentFilter === 'all' 
                ? results 
                : results.filter(r => r.type === currentFilter);

            const resultsHTML = filteredResults.length > 0 
                ? filteredResults.map(result => createResultHTML(result)).join('')
                : '<div class="loading"><h3>No results found</h3><p>Try adjusting your search terms or filters</p></div>';

            document.getElementById('resultsSection').innerHTML = resultsHTML;
        }

        function createResultHTML(result) {
            return `
                <div class="result-item">
                    <div class="result-header">
                        <div class="result-title" onclick="viewPDF('${result.document}', ${result.page})">${result.title}</div>
                        <div class="result-meta">
                            <span>üìÑ ${result.document}</span>
                            <span>Page ${result.page}</span>
                            <span>${result.confidence}% match</span>
                            <span>Updated ${new Date(result.lastUpdated).toLocaleDateString()}</span>
                        </div>
                    </div>
                    <div class="result-snippet">${result.snippet}</div>
                    <div class="result-actions">
                        <button class="action-btn view-pdf" onclick="viewPDF('${result.document}', ${result.page})">
                            View PDF
                        </button>
                        <button class="action-btn copy-link" onclick="copyLink('${result.document}', ${result.page})">
                            Copy Link
                        </button>
                    </div>
                </div>
            `;
        }

        function highlightSearchTerms(text, query) {
            const terms = query.toLowerCase().split(' ').filter(term => term.length > 2);
            let highlightedText = text;
            
            terms.forEach(term => {
                const regex = new RegExp(`(${term})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>');
            });
            
            return highlightedText;
        }

        function viewPDF(document, page) {
            alert(`Opening ${document} at page ${page}`);
        }

        function copyLink(document, page) {
            const link = `${window.location.origin}/documents/${document}#page=${page}`;
            navigator.clipboard.writeText(link).then(() => {
                event.target.textContent = 'Copied!';
                setTimeout(() => {
                    event.target.textContent = 'Copy Link';
                }, 2000);
            });
        }

        function setSearch(query) {
            document.getElementById('searchInput').value = query;
            document.getElementById('navSearchInput').value = query;
            performSearch();
        }

        // Auto-focus search input
        document.getElementById('searchInput').focus();
    </script>
    
    <!-- Load the external JavaScript file -->
    <script src="java.js"></script>
</body>
</html>